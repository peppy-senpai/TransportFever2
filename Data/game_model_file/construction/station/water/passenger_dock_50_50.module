local transf = require "transf"
local vec2 = require "vec2"
local vec3 = require "vec3"
local modulesutil = require "modulesutil"
local constructionutil = require "constructionutil"
local harbourstationutil = require "modules/harbourstationutil"

local cargoCapacity = 0
local passengerCapacity = 150

--Begin Generated
local generatedData = {
	["layout_main_building"] = {
		models = {
			["asset/commercial/era_a/com_1_ground_double_bench_a.mdl"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 10.30000, -12.90000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -10.30000, -12.90000, 0.00000, 1.00000, },
				{ -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 10.30000, 12.90000, 0.00000, 1.00000, },
				{ -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -10.30000, 12.90000, 0.00000, 1.00000, },
				{ 0.00000, -1.00000, 0.00000, 0.00000, 1.00000, 0.00000, -0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -12.90000, 10.30000, 0.00000, 1.00000, },
				{ 0.00000, -1.00000, 0.00000, 0.00000, 1.00000, 0.00000, -0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -12.90000, -10.30000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, -0.00000, 0.00000, -0.00000, -0.00000, 1.00000, 0.00000, 12.90000, -10.30000, -0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, -0.00000, 0.00000, -0.00000, -0.00000, 1.00000, 0.00000, 12.90000, 10.30000, 0.00000, 1.00000, },
			},
			["station/water/asset/era_a/gangway_s1.mdl"] = {
				{ 0.20450, 0.97887, 0.00000, 0.00000, -0.97420, 0.20352, 0.09758, 0.00000, 0.09552, -0.01996, 0.99523, 0.00000, -0.10068, 0.02552, 0.00000, 1.00000, },
			},
			["street/street_asset_mix/trash_standing_a.mdl"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -16.75500, -16.60000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -16.75500, 16.60000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 16.75500, 16.60000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 16.75500, -16.60000, 0.00000, 1.00000, },
			},
			["street/street_light_eu_a.mdl"] = {
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00000, 12.50000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00000, 23.00000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00000, -0.00000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00000, -12.50000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -23.00000, 12.50000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -23.00000, 23.00000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -23.00000, -0.00000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -23.00000, -12.50000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 12.50000, -23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 12.50000, 23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00000, -23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -0.00000, -23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -0.00000, 23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -12.50000, -23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -12.50000, 23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -23.00000, -23.00000, 0.00000, 1.00000, },
			},
		},
	},
}
--End Generated

function data()

local modelConfig = {
	main = "station/water/era_a/platform_50.mdl",
	addons = { "station/water/era_a/main_building_s1.mdl" , "station/water/era_a/main_building_s1_network_person.mdl"},
	con_l = {},
	con_r = {},
	con_t = {},
	con_b = {},
	end_l = {},
	end_r = {},
	end_t = {},
	end_b = {},
	fence = {
		main = "station/water/era_a/safeguard_wood.mdl",
		con_l = "station/water/era_a/safeguard_wood_con_l.mdl",
		con_r = "station/water/era_a/safeguard_wood_con_r.mdl",
		end_l = "station/water/era_a/safeguard_wood_end_l.mdl",
		end_r = "station/water/era_a/safeguard_wood_end_r.mdl",
		corner_in = "station/water/era_a/safeguard_wood_corner_in.mdl",
		corner_out = "station/water/era_a/safeguard_wood_corner_out.mdl",
		ftype = 1
	}
}

return { 
	cost = {
		price = 50000,
	},
	category = {
		categories = { "passenger", },
	},
	description = {
		name = _("Main building"),
		description = _("Main building for passenger harbors. Provides capacity for 150 passengers."),
		icon = "ui/construction/station/water/passenger_main_building.tga"
	}, 
	availability = {
		yearFrom = 1850,
		yearTo = 0,
	},
	type = "water_module_50_50",
	order = {
		value = 11,
	},
	metadata = {
		platform = true,
		passenger = true,
		type = 0,
		moreCapacity = {
			cargo = cargoCapacity,
			passenger = passengerCapacity
		}
	},
	
	updateFn = function(result, transformInvalid, tag, slotId, addModelFnInvalid, params)
		local coordI, coordJ, facing = result.DemangleId(slotId)
		local size = {4, 4}

		local bounds, center, range = result.MakeBoundsAndCenter(slotId, size, coordI, coordJ, facing)

		local connect = {
			left = false,
			right = false,
			bottom = false,
			top = false,
		}
		
		table.insert(result.InvokeLater, function()
			result.ForEachLeft(bounds, function(slotInfo, mod, I, i, j)
				connect.left = true
				result.SetFence(i + 1, j, 3, 0)
			end, function(I, i, j) result.SetFence(i + 1, j, 3, modelConfig.fence.ftype) end)
			result.ForEachRight(bounds, function(slotInfo, mod, I, i, j) 
				connect.right = true
				result.SetFence(i - 1, j, 1, 0)
			end, function(I, i, j) result.SetFence(i - 1, j, 1, modelConfig.fence.ftype) end)
			result.ForEachTop(bounds, function(slotInfo, mod, I, i, j)
				connect.top = true
				result.SetFence(i, j - 1, 2, 0)
			end, function(I, i, j) result.SetFence(i, j - 1, 2, modelConfig.fence.ftype) end)
			result.ForEachBottom(bounds, function(slotInfo, mod, I, i, j) 
				connect.bottom = true
				result.SetFence(i, j + 1, 0, 0)
			end, function(I, i, j) result.SetFence(i, j + 1, 0, modelConfig.fence.ftype) end)
			
			result.coord2slotId[coordI][coordJ].connect = connect
		end)
		
		result.addModuleData[slotId] = function(transform, addModelFn)
			local function fn(tf)
				constructionutil.addModelsAndGroups(params, generatedData["layout_main_building"], result, tag, tf)
			end
			
			local variant = params.modules[slotId].variant
			result.ApplyConfig(bounds, center, transform, modelConfig, addModelFn, connect, facing, variant, fn)
		end
		
		result.AddFace(bounds, nil, -0.3)
		
		result.MakeSlots(bounds, range[12], "12_12")
		result.MakeSlots(bounds, range[12], "50_12")
		result.MakeSlots(bounds, range[50], "50_12_flip")
		result.MakeSlots(bounds, range[25], "100_25")
		result.MakeSlots(bounds, range[100], "100_25_flip")
		result.MakeSlots(bounds, range[50], "100_50")
		result.MakeSlots(bounds, range[100], "100_50_flip")
		result.MakeSlots(bounds, range[50], "50_50")
		result.MakeSlots(bounds, range[50], "50_50_flip")

	end,
	
	getModelsFn = function()
		local result = harbourstationutil.MakePreview(modelConfig)
		
		local transform = transf.scale(vec3.new(1, 1, 1))
	
		constructionutil.addModels(generatedData["layout_main_building"], result, transform)
	
		return result
		
	end
}

end
