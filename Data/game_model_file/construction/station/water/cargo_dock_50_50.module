local transf = require "transf"
local vec2 = require "vec2"
local vec3 = require "vec3"
local modulesutil = require "modulesutil"
local constructionutil = require "constructionutil"
local harbourstationutil = require "modules/harbourstationutil"

local cargoCapacity = 200
local passengerCapacity = 0

--Begin Generated
local generatedData = {
	["layout_main_building"] = {
		models = {
			["asset/ground/container_fluid.mdl"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 21.50648, -10.65000, -0.00000, 1.00000, },
				{ -0.19423, 0.98096, 0.00000, 0.00000, -0.98096, -0.19423, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 22.30648, -14.79000, -0.00000, 1.00000, },
				{ 0.91355, -0.40674, 0.00000, 0.00000, 0.40674, 0.91355, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 21.10648, -12.90000, -0.00000, 1.00000, },
			},
			["asset/industry/cardboard_box_01.mdl"] = {
				{ -0.34530, -0.93849, 0.00000, 0.00000, 0.93849, -0.34530, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -13.83089, 10.66259, 0.50694, 1.00000, },
				{ 0.99863, -0.05234, 0.00000, 0.00000, 0.05234, 0.99863, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -14.51000, 10.44000, 0.00000, 1.00000, },
				{ -0.92849, -0.37137, 0.00000, 0.00000, 0.37137, -0.92849, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -14.39000, 9.04000, 0.00000, 1.00000, },
				{ 0.61015, -0.79229, 0.00000, 0.00000, 0.79229, 0.61015, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -13.59000, 10.44000, 0.00000, 1.00000, },
			},
			["asset/industry/pallet_01.mdl"] = {
				{ 1.00000, 0.00167, 0.00000, 0.00000, -0.00167, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.80000, -8.08000, 0.14500, 1.00000, },
				{ 0.99749, 0.07076, 0.00000, 0.00000, -0.07076, 0.99749, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.80000, -8.08000, 0.29000, 1.00000, },
				{ 1.00000, 0.00238, 0.00000, 0.00000, -0.00238, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.80000, -8.08000, 0.43500, 1.00000, },
				{ 0.99392, 0.11008, 0.00000, 0.00000, -0.11008, 0.99392, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.80000, -8.08000, 0.58000, 1.00000, },
				{ 1.00000, 0.00272, 0.00000, 0.00000, -0.00272, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.80000, -8.08000, 0.72500, 1.00000, },
				{ 0.99643, 0.08442, 0.00000, 0.00000, -0.08442, 0.99643, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.80000, -8.08000, 0.87000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -0.50000, -0.00000, 0.86603, 0.00000, 0.86603, 0.00000, 0.50000, 0.00000, 12.43000, -6.70000, 0.51000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.80000, -8.08000, 0.00000, 1.00000, },
			},
			["asset/industry/wooden_box_04.mdl"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -22.70000, -10.30000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -21.08000, -10.30000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -21.39000, -1.05000, 0.00000, 1.00000, },
				{ 0.86074, 0.50904, 0.00000, 0.00000, -0.50904, 0.86074, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -13.97267, 0.07495, 1.85518, 1.00000, },
				{ 0.99122, 0.13226, 0.00000, 0.00000, -0.13226, 0.99122, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -14.15000, -1.47000, 0.00000, 1.00000, },
				{ 0.98027, -0.19766, 0.00000, 0.00000, 0.19766, 0.98027, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -21.74000, 0.90000, 0.00000, 1.00000, },
				{ -0.03839, -0.99926, 0.00000, 0.00000, 0.99926, -0.03839, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -13.72000, 0.48000, 0.00000, 1.00000, },
			},
			["station/air/asset/handcart_luggage_a.mdl"] = {
				{ -0.69576, -0.71297, -0.08716, 0.00000, 0.71569, -0.69842, -0.00000, 0.00000, -0.06087, -0.06238, 0.99619, 0.00000, -13.72000, -9.25000, 0.00000, 1.00000, },
				{ -0.97688, 0.19520, -0.08716, 0.00000, -0.19595, -0.98061, 0.00000, 0.00000, -0.08547, 0.01708, 0.99619, 0.00000, -13.75099, -7.24621, 0.00000, 1.00000, },
				{ -0.60529, 0.79600, -0.00000, 0.00000, -0.00000, -0.00000, 1.00000, 0.00000, 0.79600, 0.60529, 0.00000, 0.00000, -14.29099, -5.96621, 0.57000, 1.00000, },
			},
			["station/rail/asset/cargo_lamps.mdl"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -23.00000, 0.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00000, 0.00000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -0.00000, 23.00000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -0.00000, -23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -23.00000, -12.50000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00000, -12.50000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 12.50000, 23.00000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 12.50000, -23.00000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -23.00000, 12.50000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00000, 12.50000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -12.50000, 23.00000, 0.00000, 1.00000, },
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -12.50000, -23.00000, 0.00000, 1.00000, },
			},
			["station/rail/asset/cargo_pallet_jack.mdl"] = {
				{ -0.99990, 0.01396, 0.00000, 0.00000, -0.01396, -0.99990, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 14.04000, -4.45206, 0.00000, 1.00000, },
				{ -0.87965, 0.47562, 0.00000, 0.00000, -0.47562, -0.87965, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.70000, -5.75206, 0.00000, 1.00000, },
			},
			["station/rail/asset/cargo_speakers.mdl"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -22.92000, 22.92000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 22.91000, 22.92000, 0.00000, 1.00000, },
			},
			["station/rail/asset/era_a_holder_wall.mdl"] = {
				{ -0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 12.30000, 5.19534, 1.00000, },
			},
			["station/rail/asset/era_a_small_clock.mdl"] = {
				{ -0.00000, 1.50000, 0.00000, 0.00000, -1.50000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.50000, 0.00000, -0.00000, 13.56500, 4.56534, 1.00000, },
			},
			["station/water/asset/era_a/anchor.mdl"] = {
				{ 0.92587, 0.37784, 0.00000, 0.00000, -0.37784, 0.92587, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -20.56000, -20.30000, 0.00000, 1.00000, },
			},
			["station/water/asset/era_a/gangway_s2.mdl"] = {
				{ -0.02094, -0.00000, 0.99978, 0.00000, 0.14173, -0.98990, 0.00297, 0.00000, 0.98968, 0.14177, 0.02073, 0.00000, 13.01454, 5.26154, 0.56328, 1.00000, },
			},
			["station/water/era_a/main_building_cargo_s1_sm.mdl"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, },
			},
			["street/street_asset_mix/trash_standing_a.mdl"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 3.50000, -13.19000, 0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -3.50000, -13.19000, 0.00000, 1.00000, },
			},
		},
		groups = {
			["era_a_barrel_wood.grp"] = {
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 22.80649, 14.98596, -0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00649, 10.63596, -0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 23.00649, 13.58596, -0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 21.75649, 13.90596, -0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 21.65649, 10.73596, -0.00000, 1.00000, },
				{ 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 20.42649, 11.45596, -0.00000, 1.00000, },
				{ 0.68951, 0.72176, -0.06032, 0.00000, -0.08716, -0.00000, -0.99619, 0.00000, -0.71901, 0.69214, 0.06291, 0.00000, 21.82649, 11.96596, 0.46000, 1.00000, },
			},
			["era_a_container.grp"] = {
				{ -1.00000, 0.00000, 0.00000, 0.00000, -0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.05000, 13.15000, 0.00000, 1.00000, },
			},
			["era_a_wooden_box_on.grp"] = {
				{ -0.59061, 0.80696, 0.00000, 0.00000, -0.80696, -0.59061, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -22.88048, 10.51151, 0.89113, 1.00000, },
				{ 0.01745, 0.99985, 0.00000, 0.00000, -0.99985, 0.01745, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -22.81000, 9.80000, 0.00000, 1.00000, },
				{ 0.01745, 0.99985, 0.00000, 0.00000, -0.99985, 0.01745, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -22.81000, 13.58000, 0.00000, 1.00000, },
				{ 0.35184, 0.93606, 0.00000, 0.00000, -0.93606, 0.35184, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -22.81000, 11.32000, 0.00000, 1.00000, },
				{ -0.28903, 0.95732, 0.00000, 0.00000, -0.95732, -0.28903, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -22.49000, 14.86000, 0.00000, 1.00000, },
				{ 0.97072, 0.24023, 0.00000, 0.00000, -0.24023, 0.97072, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -21.57000, 10.64000, 0.00000, 1.00000, },
				{ 0.96269, -0.27060, 0.00000, 0.00000, 0.27060, 0.96269, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -21.57000, 13.16000, 0.00000, 1.00000, },
			},
			["era_b_garbage_container.grp"] = {
				{ -0.07672, -0.99705, 0.00000, 0.00000, 0.99705, -0.07672, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -13.06351, 5.70000, 0.00000, 1.00000, },
				{ 0.00000, -1.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -13.06351, 8.50000, 0.00000, 1.00000, },
			},
		},
	},
}
--End Generated

function data()

local modelConfig = {
	main = "station/water/era_a/platform_50_cargo.mdl",
	addons = { "station/water/era_a/main_building_s1_cargo.mdl", "station/water/era_a/main_building_s1_network_cargo.mdl" },
	con_l = {},
	con_r = {},
	con_t = {},
	con_b = {},
	end_l = {},
	end_r = {},
	end_t = {},
	end_b = {},
	fence = {
		main = "station/water/era_a/safeguard_metal.mdl",
		con_l = "station/water/era_a/safeguard_metal_con_l.mdl",
		con_r = "station/water/era_a/safeguard_metal_con_r.mdl",
		end_l = "station/water/era_a/safeguard_metal_end_l.mdl",
		end_r = "station/water/era_a/safeguard_metal_end_r.mdl",
		corner_in = "station/water/era_a/safeguard_metal_corner_in.mdl",
		corner_out = "station/water/era_a/safeguard_metal_corner_out.mdl",
		ftype = 2
	}
}

return { 
	cost = {
		price = 50000,
	},
	category = {
		categories = { "cargo", },
	},
	description = {
		name = _("Main building"),
		description = _("Main building for cargo harbors. Provides capacity for 200 cargo items."),
		icon = "ui/construction/station/water/cargo_main_building.tga"
	}, 
	availability = {
		yearFrom = 1850,
		yearTo = 0,
	},
	type = "water_module_50_50",
	order = {
		value = 12,
	},
	metadata = {
		platform = true,
		cargo = true,
		type = 0,
		moreCapacity = {
			cargo = cargoCapacity,
			passenger = passengerCapacity
		}
	},
	
	updateFn = function(result, transformInvalid, tag, slotId, addModelFnInvalid, params)
		local coordI, coordJ, facing = result.DemangleId(slotId)
		local size = {4, 4}

		local bounds, center, range = result.MakeBoundsAndCenter(slotId, size, coordI, coordJ, facing)

		local connect = {
			left = false,
			right = false,
			bottom = false,
			top = false,
		}
		
		table.insert(result.InvokeLater, function()
			result.ForEachLeft(bounds, function(slotInfo, mod, I, i, j)
				connect.left = true
				result.SetFence(i + 1, j, 3, 0)
			end, function(I, i, j) result.SetFence(i + 1, j, 3, modelConfig.fence.ftype) end)
			result.ForEachRight(bounds, function(slotInfo, mod, I, i, j) 
				connect.right = true
				result.SetFence(i - 1, j, 1, 0)
			end, function(I, i, j) result.SetFence(i - 1, j, 1, modelConfig.fence.ftype) end)
			result.ForEachTop(bounds, function(slotInfo, mod, I, i, j)
				connect.top = true
				result.SetFence(i, j - 1, 2, 0)
			end, function(I, i, j) result.SetFence(i, j - 1, 2, modelConfig.fence.ftype) end)
			result.ForEachBottom(bounds, function(slotInfo, mod, I, i, j) 
				connect.bottom = true
				result.SetFence(i, j + 1, 0, 0)
			end, function(I, i, j) result.SetFence(i, j + 1, 0, modelConfig.fence.ftype) end)
			
			result.coord2slotId[coordI][coordJ].connect = connect
		end)
		
		result.addModuleData[slotId] = function(transform, addModelFn)
			local function fn(tf)
				constructionutil.addModelsAndGroups(params, generatedData["layout_main_building"], result, tag, tf)
			end
			
			local variant = params.modules[slotId].variant
			result.ApplyConfig(bounds, center, transform, modelConfig, addModelFn, connect, facing, variant, fn)
		end
		result.AddFace(bounds, nil, -0.3)
		
		result.MakeSlots(bounds, range[12], "12_12")
		result.MakeSlots(bounds, range[12], "50_12")
		result.MakeSlots(bounds, range[50], "50_12_flip")
		result.MakeSlots(bounds, range[25], "100_25")
		result.MakeSlots(bounds, range[100], "100_25_flip")
		result.MakeSlots(bounds, range[50], "100_50")
		result.MakeSlots(bounds, range[100], "100_50_flip")
		result.MakeSlots(bounds, range[50], "50_50")
		result.MakeSlots(bounds, range[50], "50_50_flip")

	end,
	
	getModelsFn = function()
		local result = harbourstationutil.MakePreview(modelConfig)
		
		local transform = transf.scale(vec3.new(1, 1, 1))
	
		constructionutil.addModels(generatedData["layout_main_building"], result, transform)
	
		return result
	end
}

end
